## 3.7 적합한 가비지 컬렉터 선택하기
### 3.7.1 엡실론 컬렉터
- 가비지 컬렉션을 하지 않는 컬렉터
- 동작 부하가 적음
- 메모리를 회수하지 않아 메모리 한계를 초과하면 애플리케이션이 종료됨
- 사례
  - JVM에서 GC 없이 정상 동작하는지 확인하기 위한 테스트
  - GC 영향을 배제해야 하는 성능, 스트레스 테스트에 사용
  - 메모리를 적게 사용하고 실행 시간이 짧은 애플리케이션에 적합
<br><br>

### 3.7.2 컬렉터들 간 비교 및 취사선택
**컬렉터 선택 기준**
1. 애플리케이션의 주목적 : 처리량, 지연 시간, 메모리 사용량 등
2. 운영환경 : 하드웨어 아키텍처, 프로세서 개수, 가용 메모리 용량, 운영체제 등
3. JDK 제공자와 버전
<br>

**브라우저-서버 시스템 예시**
- 자금 여유, 최적화 경험 부족 -> 유료 기술 지원, 전용 하드웨어, 상용 컬렉터
- 기술 제어 가능, 지연 시간 중요 -> 최신 JDK, ZGC, 셰넌도어
- 레거시 시스템에서 운영 -> G1

**오라클 기준 예시**
- 작은 데이터(최대 100MB), 단일 프로세서 사용, 일시 정지 시간 제약 X -> 시리얼 컬렉터
- 최대 성능 중요, 지연 시간 허용(1초 이상) -> 가상 머신 기본 컬렉터나 패러렐 컬렉터
- 응답 시간 중요, 짧은 일시 정지 -> G1
- 응답 시간 매우 중요 -> ZGC
<br><br>

### 3.7.3 가상 머신과 가비지 컬렉터 로그
- -Xlog 매개 변수로 모든 핫스팟 기능의 로그 설정 가능
  ```bash
  -Xlog[:[**selector**][:[output][:[decorators][:output-options]]]]

**실렉터(selector)**
- 태그 : 가상 머신의 기능 모듈 이름. 어떤 기능의 로그를 보고 싶은지 알려주는 역할.
- 로그 레벨 : 출력 정보의 상세함 정도
  - Trace(추적), Debug(디버그),  Info(정보, 기본값), Warning(주의), Error(오류),  Off(끔)

**데커레이터(decorators)**
- 로그를 해석하기 쉽게 함
- 로그 출력에 추가 정보를 포함하는 옵션
  - 시간, 프로세스 ID, 스레드 ID, 로그 레벨 등

$$$$ 데커레이터 형태같은 사진 첨부

**GC 프로세스 관련 정보 얻기**
- 기본 정보 `-Xlog:gc`
- 상세 정보 `-Xlog:gc*`
- GC 전후 가용한 힙과 메서드 영역 용량 변화 `-Xlog:gc+heap=debug`
- GC 중 동시 실행 시간과 일시 정지 시간 `-Xlog:safepoint`
- 자동 조절 메커니즘 관련 정보 `-Xlog:gc+ergo*=trace`
- 회수 후 남은 객체들의 나이 분포 `-Xlog:gc+age=trace`
<br><br>


## 3.8 실전: 메모리 할당과 회수 전략
- 객체 메모리 할당은 힙에서 발생
- 일반적으로 신세대에 할당하고, 객체 크기가 특정 문턱값보다 크면 구세대에 할당되기도 함
- 현재 GC와 메모리 관련 가상 머신 매개변수 설정에 따라 전략이 달라짐
<br><br>

### 3.8.1 객체는 먼저 에덴에 할당된다
> 에덴(Eden)
    - 신세대 내에서 객체가 최초로 할당되는 영역
    - 상대적으로 작은 메모리 영역. 메모리 회수 주기가 짧고 빠르다

- 대부분 객체는 신세대의 에덴에 할당되고, 에덴의 공간이 부족해지면 가상머신은 마이너 GC 발생
<br><br>

### 3.8.2 큰 객체는 곧바로 구세대에 할당된다
- 큰 객체는 커다란 연속된 메모리 공간을 필요로 하는 자바 객체<br>
  -> 여유 공간이 많아도 가비지 컬렉션을 해야되는 상황 자주 발생
- 큰 객체를 담는 연속된 공간을 확보하면서 메모리 복사 오버헤드 동반<br>
  -> -XX:PretenureSizeThreshold 매개 변수를 설정<br>
  -> 설정값보다 큰 객체를 바로 구세대에 할당
<br><br>

### 3.8.3 나이가 차면 구세대로 옮겨진다
- 객체는 주로 에덴에서 태어나고 초기 나이는 0
- 첫번째 마이너 GC에서 살아남으면 생존자 공간으로 옮겨지면서 나이 +1
- 생존자 공간에서 마이너 GC를 겪을 때마다 나이 +1
- -XX:MaxTenuringThreshold 매개변수로 구세대로 승격되는 나이 지정
<br><br>

### 3.8.4 공간이 비좁으면 강제로 승격시킨다
- 생존 객체 크기 총합이 생존자 공간 절반을 넘으면 모든 객체를 구세대로 이동. 나이는 무시
- -XX:TargetSurvivorRatio 매개변수로 생존자 공간 크기 지정
<br><br>